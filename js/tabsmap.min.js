(function(a){a(document).ready(function(){a("[data-tabmap]").each(function(){var c=a(this),b=c.data("tabmap"),d=Joomla.getOptions(b,""),f=false;if(d!==""){var e=setInterval(function(){if(a("#"+d.params.container).width()>0&&a("#"+d.params.container).height()>0){clearInterval(e);ymaps.ready(function(){var j={};j.center=[0,0];j.zoom=0;var m=localStorage.getItem("map");if(m){m=a.parseJSON(m);if(m.center){j.center=m.center}if(m.zoom){j.zoom=m.zoom}}f=new ymaps.Map(d.params.container,{center:j.center,zoom:j.zoom,controls:["zoomControl","fullscreenControl","geolocationControl"]});var g=a.parseJSON(d.params.center),k=d.params.zoom*1;f.setCenter(g,k,{checkZoomRange:true});f.geoObjects.removeAll();var l=a.parseJSON(d.placemark.coordinates),h={};if(d.placemark.options){a.each(d.placemark.options,function(n,o){if(n=="customLayout"){n="iconLayout";o=ymaps.templateLayoutFactory.createClass(o)}h[n]=o})}else{h.iconLayout="default#image";h.iconImageHref="/media/plg_fieldtypes_map/images/placemark.png";h.iconImageSize=[48,48];h.iconImageOffset=[-24,-48]}var i=new ymaps.Placemark(l,{},h);f.geoObjects.add(i);f.events.add("boundschange",function(p){if(p.get("newZoom")!=p.get("oldZoom")){var o=p.get("newZoom");j.zoom=o}if(p.get("newCenter")!=p.get("oldCenter")){var r=p.get("newCenter")[0].toFixed(6),q=p.get("newCenter")[1].toFixed(6),n=[r,q];j.center=n;j.latitude=r;j.longitude=q}localStorage.setItem("map",JSON.stringify(j))})})}},3)}})})})(jQuery);