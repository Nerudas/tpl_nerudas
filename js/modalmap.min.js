/*
 * @package    Nerudas Template
 * @version    4.9.5
 * @author     Nerudas  - nerudas.ru
 * @copyright  Copyright (c) 2013 - 2018 Nerudas. All rights reserved.
 * @license    GNU/GPL license: http://www.gnu.org/copyleft/gpl.html
 * @link       https://nerudas.ru
 */

(function(a){a(document).ready(function(){if(a("#modalmap").length==0){var c='<div id="modalmap" class="uk-modal">\n    <div id="modalmap_map" class="uk-modal-dialog">\n        <a class="uk-modal-close uk-close"></a>\n    </div>\n</div>';a("body").append(a(c))}var e=UIkit.modal("#modalmap"),g=false;a("[data-modalmap]").each(function(){var i=a(this),h=i.data("modalmap"),j=Joomla.getOptions(h,"");if(j!==""){a(i).on("click",function(){e.show();b(j)})}});function b(h){if(!g){f()}d(function(m){var i=a.parseJSON(h.params.center),l=h.params.zoom*1;m.setCenter(i,l,{checkZoomRange:true});m.geoObjects.removeAll();var n=a.parseJSON(h.placemark.coordinates),j={};if(h.placemark.options){a.each(h.placemark.options,function(o,p){if(o=="customLayout"){o="iconLayout";p=ymaps.templateLayoutFactory.createClass(p)}j[o]=p})}else{j.iconLayout="default#image";j.iconImageHref="/media/plg_fieldtypes_map/images/placemark.png";j.iconImageSize=[48,48];j.iconImageOffset=[-24,-48]}var k=new ymaps.Placemark(n,{},j);m.geoObjects.add(k)})}function d(i){var h=setInterval(function(){if(g){clearInterval(h);i(g)}},3)}function f(){var h=setInterval(function(){a("#modalmap_map").height(Math.round((a("#modalmap_map").width()/4)*3));if(a("#modalmap_map").width()>0&&a("#modalmap_map").height()>0){clearInterval(h);ymaps.ready(function(){var i={};i.center=[0,0];i.zoom=0;var j=localStorage.getItem("map");if(j!==""){j=a.parseJSON(j);if(j.center){i.center=j.center}if(j.zoom){i.zoom=j.zoom}}g=new ymaps.Map("modalmap_map",{center:i.center,zoom:i.zoom,controls:["zoomControl","fullscreenControl","geolocationControl"]});g.events.add("boundschange",function(m){if(m.get("newZoom")!=m.get("oldZoom")){var l=m.get("newZoom");i.zoom=l}if(m.get("newCenter")!=m.get("oldCenter")){var o=m.get("newCenter")[0].toFixed(6),n=m.get("newCenter")[1].toFixed(6),k=[o,n];i.center=k;i.latitude=o;i.longitude=n}localStorage.setItem("map",JSON.stringify(i))})})}},3)}})})(jQuery);