/*
 * @package    Nerudas Template
 * @version    4.9.5
 * @author     Nerudas  - nerudas.ru
 * @copyright  Copyright (c) 2013 - 2018 Nerudas. All rights reserved.
 * @license    GNU/GPL license: http://www.gnu.org/copyleft/gpl.html
 * @link       https://nerudas.ru
 */

(function(a){a(document).ready(function(){if(a("#modalmap").length==0){var b='<div id="modalmap" class="uk-modal">\n    <div id="modalmap_map" class="uk-modal-dialog">\n        <a class="uk-modal-close uk-close"></a>\n    </div>\n</div>';a("body").append(a(b))}var d=UIkit.modal("#modalmap"),f=false;a("[data-modalmap]").each(function(){var h=a(this),g=h.data("modalmap"),i=Joomla.getOptions(g,"");if(i!==""){a(h).on("click",function(){d.show();if(!f){e()}c(function(n){var j=a.parseJSON(i.params.center),m=i.params.zoom*1;n.setCenter(j,m,{checkZoomRange:true});n.geoObjects.removeAll();var o=a.parseJSON(i.placemark.coordinates),k={};if(i.placemark.options){a.each(i.placemark.options,function(p,q){if(p=="customLayout"){p="iconLayout";q=ymaps.templateLayoutFactory.createClass(q)}k[p]=q})}else{k.iconLayout="default#image";k.iconImageHref="/media/plg_fieldtypes_map/images/placemark.png";k.iconImageSize=[48,48];k.iconImageOffset=[-24,-48]}var l=new ymaps.Placemark(o,{},k);n.geoObjects.add(l);if(i.link){l.events.add("click",function(){window.location.href=i.link})}})})}});function c(h){var g=setInterval(function(){if(f){clearInterval(g);h(f)}},3)}function e(){var g=setInterval(function(){a("#modalmap_map").height(Math.round((a("#modalmap_map").width()/4)*3));if(a("#modalmap_map").width()>0&&a("#modalmap_map").height()>0){clearInterval(g);ymaps.ready(function(){var h={};h.center=[0,0];h.zoom=0;var i=localStorage.getItem("map");if(i){i=a.parseJSON(i);if(i.center){h.center=i.center}if(i.zoom){h.zoom=i.zoom}}f=new ymaps.Map("modalmap_map",{center:h.center,zoom:h.zoom,controls:["zoomControl","fullscreenControl","geolocationControl"]});f.events.add("boundschange",function(l){if(l.get("newZoom")!=l.get("oldZoom")){var k=l.get("newZoom");h.zoom=k}if(l.get("newCenter")!=l.get("oldCenter")){var n=l.get("newCenter")[0].toFixed(6),m=l.get("newCenter")[1].toFixed(6),j=[n,m];h.center=j;h.latitude=n;h.longitude=m}localStorage.setItem("map",JSON.stringify(h))})})}},3)}})})(jQuery);